# OAuth 란
요즘 대부분의 서비스는 별도의 회원가입 없이
“Google로 로그인, Kakao로 로그인, GitHub로 로그인” 버튼으로 시작한다.

이 기능이 가능한 이유가 바로 OAuth 2.0이다.

OAuth는 로그인만을 위한 기술이 아니라,
"내 리소스에 대한 접근 권한을 제3자에게 위임" 하는 표준 프로토콜이다.

OAuth (Open Authorization) 는
사용자의 비밀번호를 직접 주지 않고,
제3자 애플리케이션이 대신 API 접근 권한을 얻을 수 있게 해주는 인증 방식이다.

쉽게 말해,

“내 계정의 일부 기능만 다른 앱이 쓸 수 있도록 허락하는 방법”

예를 들어,
내 Google 계정으로 다른 앱에서 내 이메일 주소만 가져오고 싶을 때,
OAuth를 통해 “이메일 읽기 권한”만 위임할 수 있다.

# OAuth의 4가지 역할
| 구성 요소                    | 설명                                      |
| ------------------------ | --------------------------------------- |
| **Resource Owner**       | 리소스의 주인 (예: 사용자)                        |
| **Client**               | 리소스를 이용하려는 앱 (예: 내 웹 서비스)               |
| **Resource Server**      | 리소스를 보관하는 서버 (예: Google API)            |
| **Authorization Server** | 인증/인가를 담당하는 서버 (예: accounts.google.com) |

# OAuth 2.0 동작 흐름
가장 많이 쓰이는 방식은 Authorization Code Grant이다.
```text
사용자 → 클라이언트 → 인증 서버 → 리소스 서버
```
#### 1, 사용자가 로그인 요청
 - 사용자가 내 서비스에서 “Google로 로그인” 클릭

#### 2. Authorization Server로 리다이렉트
 - 클라이언트(내 서비스)는 Google 인증 서버로 리다이렉트

#### 3. Authorization Code 발급
 - Google 인증 서버는 로그인 성공 후 Authorization Code 를 발급하여 redirect URI로 전달

#### 4. Access Token 요청
 - 클라이언트는 받은 code를 이용해 Access Token 을 요청

#### 5. Access Token 발급
 - 서버는 클라이언트에게 Access Token (그리고 선택적으로 Refresh Token)을 반환

#### 6. 리소스 서버 접근
 - 이제 클라이언트는 Access Token을 Authorization 헤더에 담아 API를 호출할 수 있다.

# Access Token & Refresh Token
| 구분                | 역할               | 유효 기간       |
| ----------------- | ---------------- | ----------- |
| **Access Token**  | API 요청 시 인증에 사용  | 짧음 (보통 1시간) |
| **Refresh Token** | Access Token 갱신용 | 김 (며칠~몇 달)  |

예시 흐름

1. Access Token 만료
2. 클라이언트가 Refresh Token으로 새 Access Token 요청
3. 서버가 새로운 Access Token 발급

# OAuth와 OpenID Connect의 차이
- OAuth 2.0 = “인가(authorization)”
- OpenID Connect (OIDC) = “인증(authentication)”

OAuth는 원래 “권한 위임”을 위한 프로토콜이다.
즉, “누구인지”를 확인하는 용도는 아니었다.

하지만 로그인 용도로도 많이 쓰이면서 OIDC가 등장했다.
OIDC는 OAuth 위에 사용자 정보를 담은 ID Token (JWT) 을 추가한 프로토콜이다.

| 항목     | OAuth 2.0    | OpenID Connect           |
| ------ | ------------ | ------------------------ |
| 목적     | 권한 위임        | 사용자 인증                   |
| 토큰     | Access Token | Access Token + ID Token  |
| 응답 데이터 | 권한 관련 정보     | 사용자 식별 정보 (sub, email 등) |

OIDC는 OAuth의 토큰 구조에 ID Token을 추가했다.

| 토큰 종류            | 역할                                     |
| ---------------- | -------------------------------------- |
| **Access Token** | 리소스(API)에 접근하기 위한 권한                   |
| **ID Token**     | 사용자의 신원 정보를 담은 JWT (예: 이메일, 이름, sub 등) |

예를 들어, Google 로그인 시 OIDC를 사용하면, Access Token과 함께 아래와 같은 ID Token을 받는다.

```json
{
  "iss": "https://accounts.google.com",
  "sub": "1234567890",
  "email": "user@gmail.com",
  "name": "홍길동"
}
```

> iss (issuer) 
> 
> 뜻: “이 토큰을 발급한 주체(issuer)”
> 
> 역할: 이 ID Token을 누가 발급했는지를 명시
> 
> 예 : "iss": "https://accounts.google.com"

> sub (Subject)
>
> 뜻: “이 토큰의 주체(사용자)”
> 
> 역할: 사용자 고유 식별자 (ID)