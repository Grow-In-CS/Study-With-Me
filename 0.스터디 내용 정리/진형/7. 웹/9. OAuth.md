# 🔐 OAuth 2.0 (Open Authorization)

---

## 📘 1. 개념 요약

**OAuth 2.0**은 인터넷 사용자(리소스 소유자)가 **비밀번호를 직접 제공하지 않고**,  
서드파티 애플리케이션이 대신 **자신의 자원(Resource)** 에 접근할 수 있도록 허용하는 **인증 및 인가 프레임워크**다.

즉,
> “비밀번호를 주지 않아도, 다른 앱이 내 데이터를 ‘권한 있는 방식으로’ 사용할 수 있게 하는 표준 방식.”

예:
- 구글 로그인으로 다른 서비스에 로그인
- 카카오/네이버/깃허브 소셜 로그인

---

## 🧠 2. 주요 용어

| 용어 | 설명 |
|------|------|
| **Resource Owner** | 자원의 실제 소유자 (사용자) |
| **Client** | 자원 접근을 요청하는 앱 (서드파티 앱) |
| **Resource Server** | 보호된 자원을 저장한 서버 (ex. Google API Server) |
| **Authorization Server** | 토큰을 발급하는 인증 서버 (ex. accounts.google.com) |
| **Access Token** | 자원 서버 접근에 필요한 인증 토큰 |
| **Refresh Token** | Access Token 재발급용 장기 토큰 |

---

## 🔄 3. 기본 동작 흐름

```
[사용자] → [클라이언트 앱] → [인증 서버] → [자원 서버]
```

![](https://blog.kakaocdn.net/dna/bCTpJu/btrm5z0d3H4/AAAAAAAAAAAAAAAAAAAAAOz_UaRlP6SXBEA5vVBnAFm5_k0HAqk_bDZwRtCXkgO5/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1764514799&allow_ip=&allow_referer=&signature=QjHg9b8d%2B1101gEm6G0tff63ya8%3D)

### 순서별 흐름
1. **사용자**가 클라이언트 앱에 로그인 요청
2. **클라이언트 앱**은 인증 서버로 리디렉션
3. **인증 서버**는 사용자에게 권한 허용 여부 요청
4. 사용자가 승인하면, **Authorization Code** 발급
5. **클라이언트 앱**은 이 코드를 서버로 보내 **Access Token** 발급 요청
6. 발급받은 Access Token으로 **Resource Server**에서 자원 접근

---

## 🧩 4. OAuth 2.0 Grant Type (인증 흐름 유형)

| 유형 | 사용 상황 | 특징 |
|------|------------|------|
| **Authorization Code Grant** | 일반 웹/모바일 앱 | 가장 일반적이며, 보안이 높음 |
| **Implicit Grant** | SPA(단일 페이지 앱) | Access Token이 URL에 직접 포함되어 보안에 취약 |
| **Resource Owner Password Credentials Grant** | 내부 시스템 | 사용자 아이디/비밀번호 직접 입력 (지양) |
| **Client Credentials Grant** | 서버-서버 간 통신 | 사용자 없이 클라이언트 인증만 수행 |
| **Device Code Grant** | TV, 콘솔 등 입력 제한 장치 | 기기에서 표시된 코드를 브라우저에서 인증 |

---

## 🧾 5. Authorization Code Grant 상세 절차

```
1️⃣ 클라이언트 → 인증서버
https://auth.example.com/authorize?
  response_type=code
  &client_id=CLIENT_ID
  &redirect_uri=https://app.example.com/callback
  &scope=read_profile
  &state=xyz

2️⃣ 인증서버 → 클라이언트 (리디렉션)
https://app.example.com/callback?code=AUTH_CODE&state=xyz

3️⃣ 클라이언트 → 인증서버 (토큰 교환)
POST /token
grant_type=authorization_code
code=AUTH_CODE
client_id=CLIENT_ID
client_secret=SECRET

4️⃣ 인증서버 → 클라이언트
{
  "access_token": "abcd1234",
  "refresh_token": "rft5678",
  "expires_in": 3600
}

5️⃣ 클라이언트 → 자원서버
GET /userinfo
Authorization: Bearer abcd1234
```

---

## 🔒 6. Access Token & Refresh Token

| 구분 | 역할 | 유효기간 |
|------|------|----------|
| **Access Token** | API 요청 시 사용 | 짧음 (예: 1시간) |
| **Refresh Token** | Access Token 재발급용 | 김 (예: 30일) |

Access Token이 만료되면 Refresh Token으로 새 토큰을 요청한다:
```http
POST /token
grant_type=refresh_token
refresh_token=rft5678
client_id=CLIENT_ID
client_secret=SECRET
```

---

## 🧱 7. Scope (권한 범위)

OAuth에서는 사용자 데이터 접근 범위를 **Scope**로 제한한다.

예:
```http
scope=profile email calendar.readonly
```

| Scope | 설명 |
|--------|------|
| `profile` | 사용자 프로필 정보 접근 |
| `email` | 이메일 주소 접근 |
| `calendar.readonly` | 읽기 전용 캘린더 접근 |

---

## 🧰 8. 실제 예시 (Google OAuth 2.0)

1. 사용자가 “Google 로그인” 클릭
2. 구글 인증 페이지 리디렉션
3. 사용자가 로그인 + 권한 승인
4. 앱은 `Authorization Code` 수신
5. 서버에서 Access Token 발급받고 사용자 데이터 요청

---

## ⚙️ 9. 보안 이슈 및 대책

| 문제 | 설명 | 대책 |
|------|------|------|
| **토큰 탈취** | Access Token이 유출되면 악용 가능 | HTTPS 사용, 짧은 만료 시간 |
| **Redirect URI 위조** | 공격자가 Redirect URI를 조작 | Redirect URI 화이트리스트 |
| **CSRF 공격** | 상태 코드(state) 미검증 시 위험 | `state` 파라미터 검증 필수 |
| **Implicit Flow 취약성** | Token이 URL에 노출됨 | PKCE(Code Challenge) 사용 |

---

## 🔑 10. PKCE (Proof Key for Code Exchange)

PKCE는 모바일 앱/SPA 환경에서 **Authorization Code 탈취를 방지**하는 기술이다.

| 단계 | 설명 |
|------|------|
| 1️⃣ | 클라이언트가 `code_verifier` 생성 후 해시(`code_challenge`)와 함께 요청 |
| 2️⃣ | 인증 서버는 `code_challenge` 저장 |
| 3️⃣ | 토큰 교환 시 클라이언트가 `code_verifier` 전달 |
| 4️⃣ | 서버가 해시 비교 후 일치 시 토큰 발급 |

---

## 🧠 11. 핵심 요약

- OAuth는 **비밀번호 공유 없이** 안전하게 타 서비스의 자원에 접근하도록 하는 표준 프로토콜
- `Access Token`으로 인증, `Refresh Token`으로 갱신
- 보안을 위해 **HTTPS**, **Redirect URI 검증**, **PKCE** 등을 반드시 적용해야 함

---

📘 **References**
- [OAuth 2.0 RFC 6749](https://datatracker.ietf.org/doc/html/rfc6749)
- [OAuth 2.0 Simplified – Aaron Parecki](https://www.oauth.com/)
- [Google Identity Platform](https://developers.google.com/identity/protocols/oauth2)
