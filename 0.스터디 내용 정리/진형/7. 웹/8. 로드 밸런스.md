# ⚙️ 로드 밸런싱 (Load Balancing)

---

## 📘 1. 개념 요약

**로드 밸런싱(Load Balancing)**이란 여러 서버나 네트워크 경로에 트래픽(요청)을 **균등하게 분산**하여  
시스템의 성능, 안정성, 확장성을 높이는 기술이다.

![](https://velog.velcdn.com/images/cks8483/post/20097706-a5e3-48ed-af48-606f085dd006/image.png)

> 하나의 서버에 요청이 몰리지 않도록, 여러 서버로 나누어 부하(Load)를 분산시키는 것.

---

## 🧠 2. 로드 밸런서(Load Balancer)란?

로드 밸런서는 클라이언트의 요청을 받아 여러 서버 중 하나로 트래픽을 전달하는 **트래픽 분산 장치**다.

| 구분 | 설명 |
|------|------|
| **하드웨어 로드 밸런서** | 물리 장비 형태 (예: F5, Citrix) |
| **소프트웨어 로드 밸런서** | 소프트웨어 기반 (예: Nginx, HAProxy, AWS ELB) |

---

## 🧩 3. 로드 밸런싱의 필요성

| 문제 | 로드 밸런싱이 해결하는 점 |
|------|------------------|
| 특정 서버에 트래픽 집중 | 요청을 여러 서버로 분산하여 서버 과부하 방지 |
| 서버 장애 발생 | 자동으로 다른 서버로 트래픽 전환 (Failover) |
| 트래픽 증가 | 수평적 확장 (서버 추가 시 자동 분산) |

---

## 🧮 4. 로드 밸런싱 알고리즘

| 알고리즘 | 설명 |
|-----------|------|
| **Round Robin** | 요청을 서버 순서대로 차례차례 분배 |
| **Weighted Round Robin** | 서버 성능에 따라 가중치를 부여하여 분배 |
| **Least Connections** | 현재 연결 수가 가장 적은 서버에 배분 |
| **IP Hash** | 클라이언트 IP를 기반으로 특정 서버에 고정 |
| **Random** | 무작위로 서버 선택 |
| **Consistent Hashing** | 특정 키(예: 사용자 ID)를 기반으로 서버 고정 (세션 유지에 유리) |

---

## 🌐 5. 로드 밸런싱 구조

```
사용자 요청
      ↓
 ┌────────────┐
 │ Load Balancer │  ← 요청 분산 담당
 └────────────┘
  ↙      ↓      ↘
서버1   서버2   서버3
```

---

## ⚙️ 6. 로드 밸런서의 계층별 분류

| 구분 | 설명 | 예시 |
|------|------|------|
| **L4 로드 밸런서** | 전송 계층 (IP, TCP, UDP)에서 부하 분산 | AWS NLB, HAProxy(L4) |
| **L7 로드 밸런서** | 애플리케이션 계층 (HTTP, HTTPS)에서 부하 분산 | Nginx, AWS ALB, Traefik |

### 🔹 L4 특징
- 패킷 헤더(IP/Port) 기반 라우팅
- 빠르고 단순함
- 요청 내용을 분석하지 않음

### 🔹 L7 특징
- URL, 헤더, 쿠키 등 HTTP 데이터 기반 라우팅
- 세션 유지, 인증, 캐싱 등 고급 기능 가능

---

## 🧱 7. 로드 밸런싱 방식

| 방식 | 설명 |
|------|------|
| **DNS 기반** | DNS 서버가 여러 IP를 반환하여 부하 분산 |
| **리버스 프록시 기반** | 클라이언트와 서버 사이에 로드 밸런서가 위치 |
| **애플리케이션 레벨** | 애플리케이션 내부에서 직접 분산 로직 구현 |

---

## 🔁 8. 헬스 체크 (Health Check)

로드 밸런서는 정기적으로 서버 상태를 확인하여,  
**응답이 없는 서버를 자동으로 제외**시킨다.

예시 (Nginx):
```nginx
upstream backend {
    server backend1.example.com;
    server backend2.example.com;
}

server {
    location / {
        proxy_pass http://backend;
    }
}
```

---

## ☁️ 9. 클라우드 환경의 로드 밸런서

| 서비스 | 설명 |
|---------|------|
| **AWS ELB (Elastic Load Balancer)** | ALB(L7), NLB(L4), GLB(L7+Multi-Region) 제공 |
| **GCP Load Balancer** | 전역 로드 밸런싱 지원 |
| **Azure Load Balancer** | VM 및 컨테이너 트래픽 분산 |

---

## 🧩 10. 세션 관리 전략

로드 밸런싱 시 **세션 일관성(Session Persistence)** 문제가 생길 수 있다.  
이를 해결하는 주요 방식은 다음과 같다.

| 방식 | 설명 |
|------|------|
| **Sticky Session** | 동일 사용자는 항상 같은 서버로 라우팅 |
| **Session Clustering** | 여러 서버 간 세션 데이터를 공유 |
| **외부 세션 저장소** | Redis, Memcached 등 외부 캐시 서버에 세션 저장 |

---

## 🚨 11. 로드 밸런싱의 한계

| 문제점 | 설명 |
|---------|------|
| 로드 밸런서 자체 장애 | SPOF(Single Point of Failure) 가능성 |
| 설정 복잡성 | 알고리즘 및 구성 관리 필요 |
| 상태 관리 어려움 | 세션, 캐시 등 분산 환경에서 동기화 필요 |

---

## 🧠 12. 핵심 요약

- 로드 밸런싱은 트래픽을 여러 서버로 분산하여 **성능·안정성·확장성 향상**
- 주요 유형: **L4 (네트워크), L7 (애플리케이션)**
- 클라우드 환경에서는 **AWS ELB, Nginx, HAProxy** 등이 주로 사용됨
- 세션 관리 및 장애 대응 설계도 함께 고려해야 함

---

📘 **References**
- [Nginx Load Balancing Guide](https://docs.nginx.com/nginx/admin-guide/load-balancer/)
- [AWS Elastic Load Balancing](https://aws.amazon.com/elasticloadbalancing/)
- [HAProxy Documentation](https://www.haproxy.org/)
- https://velog.io/@cks8483/2-be-week-Load-Balancing

---
