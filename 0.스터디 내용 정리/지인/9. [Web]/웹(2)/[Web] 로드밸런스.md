# 로드 밸런스

## 서버를 확장하는 방법

현대 웹 서비스는 사용자 수와 트래픽이 급격히 증가함에 따라 단일 서버만으로는 부하를 감당하기 어려워졌습니다.

이를 해결하기 위해 서버의 처리 능력과 안정성을 높이는 서버 확장 기법이 중요해졌으며, 대표적으로 두 가지 확장 방법이 사용됩니다.

<br/>

### Scale up

Scale up은 기존 서버의 하드웨어 성능을 업그레이드하여 처리 능력을 향상시키는 방법입니다.

예를 들어, CPU, RAM, 디스크 등 서버 자원을 추가하거나 클라우드 인스턴스 사양을 높이는 방식이 이에 해당합니다.

수직 확장은 추가적인 네트워크 연결 없이 자원을 늘릴 수 있어 관리나 운영이 비교적 간단하며, 데이터 일관성 유지가 용이합니다.

그러나 하드웨어나 비용의 한계로 인해 확장에 한계가 있고, 서버 장애 시 전체 서비스가 중단될 위험이 존재합니다.

<br/>

### Scale out

Scale out은 비슷한 사양의 서버를 여러 대 추가하여 부하를 분산시키는 방식입니다.

서버 수를 늘림으로써 유연한 확장성이 가능하고, 하나의 서버가 다운되어도 다른 서버가 서비스를 유지할 수 있어 가용성이 높습니다.

클라우드 환경에서는 자동으로 서버를 추가하는 오토스케일링도 지원합니다.

다만, 여러 서버를 효율적으로 관리하기 위해 로드 밸런서가 필요하며, 병렬 처리 시스템의 설계와 데이터 일관성 문제 해결을 위한 아키텍처 이해도가 요구됩니다.

<br/>

## 로드 밸런싱 (Load Balancing)

로드 밸런싱(Load Balancing)은 이렇게 여러 서버에 들어오는 부하를 고르게 분산하는 핵심 기술로서, 서비스의 성능과 안정성을 확보하는 데 필수적입니다.

과거 단일 서버 중심의 웹 서비스 환경에서는 모든 요청을 한 대의 서버가 처리했지만, 오늘날과 같이 사용자 수와 서비스 복잡도가 크게 증가한 환경에서는 여러 서버가 협력해 트래픽을 분산하는 것이 필수입니다.

<br/>

## 로드밸런싱의 기본 기능

### Health Check (상태 확인)

- 서버에 주기적으로 상태 확인을 수행하여 장애 여부를 판단하고, 정상 동작하는 서버로만 트래픽을 분산합니다.
- L3(네트워크 계층), L4(전송 계층), L7(애플리케이션 계층) 등 다양한 계층에서 수행됩니다.

<br/>

### Tunneling (터널링)

- 데이터를 캡슐화하여 전달된 노드만 해당 캡슐을 해제할 수 있도록 함으로써, 보안과 네트워크 유연성을 높여줍니다.

<br/>

### NAT (Network Address Translation)

- 내부 네트워크의 Private IP(사설 IP)를 외부 네트워크의 Public IP(공인 IP)로 변환해 트래픽을 중계하며, IP 마스킹을 통해 서버의 위치와 정보를 숨기고 네트워크를 효율적으로 관리할 수 있습니다.

<br/>

### DSR (**Direct Server Return 또는 Destination Network Address Translation**)

- 클라이언트가 요청한 데이터에 대한 응답을 서버가 직접 클라이언트로 전달하게 처리하여, 응답 시 로드 밸런서를 거치지 않아 네트워크 부하 및 병목을 줄여줍니다.

이 네 가지 기능이 현대 로드밸런서에서 필수적으로 구현되고 있으며, 대규모 서비스의 효율적인 부하 분산과 장애 대응에 중요한 역할을 합니다.

<br/>

## 로드밸런서의 종류

1. **L2 로드밸런서 (데이터 링크 계층)**
   - MAC 주소를 기반으로 트래픽을 분산시킵니다.
2. **L3 로드밸런서 (네트워크 계층)**
   - IP 주소를 기준으로 트래픽을 분산하며, 기본적인 라우팅 역할을 수행합니다.
3. **L4 로드밸런서 (전송 계층)**
   - TCP, UDP 프로토콜의 포트 번호와 IP 주소 정보를 이용해 로드 밸런싱을 수행합니다.
   - 상대적으로 빠른 속도와 낮은 비용이 장점이고, 실시간 트래픽 처리에 적합합니다.
4. **L7 로드밸런서 (애플리케이션 계층)**
   - HTTP, FTP, SMTP 같은 고수준 프로토콜을 이해하고, 요청 내용(헤더, 쿠키 등)을 기반으로 로드를 분산합니다.
   - 요청별로 세분화된 라우팅과 보안 기능(예: 비정상 트래픽 필터링)이 가능하나, 비용이 높고 복잡성이 큽니다.

<br/>

## 로드밸런싱 알고리즘

1. **라운드 로빈 (Round Robin)**
   - 서버에 순차적으로 요청을 분배하는 가장 단순한 방식입니다.
   - 서버 사양이 비슷하고 세션 지속 시간이 짧은 환경에 적합합니다.
2. **가중 라운드 로빈 (Weighted Round Robin)**
   - 각 서버에 가중치를 부여하여 가중치가 높은 서버에 더 많은 요청을 분배합니다.
   - 서버 성능이 서로 다를 때 유용합니다.
3. **최소 연결수 (Least Connection)**
   - 현재 연결된 세션 수가 가장 적은 서버에 새로운 요청을 할당합니다.
   - 세션이 오래 지속되거나 불균형한 부하 발생 시 효과적입니다.
4. **최소 응답 시간 (Least Response Time)**
   - 응답 시간이 가장 빠른 서버에 요청을 할당하여 성능을 최적화합니다.
5. **IP 해시 (IP Hash)**
   - 클라이언트 IP 주소를 해싱하여 특정 서버에 지속적으로 연결되도록 합니다.
   - 세션 지속성이 필요한 서비스에 적합합니다.
6. **대역폭 기반 (Bandwidth)**
   - 각 서버의 네트워크 대역폭 사용량을 고려해 트래픽을 분산합니다.

<br/>
<br/>

> 참고
>
> - https://co-no.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1
> - https://twojun-space.tistory.com/158
> - https://blog.voidmainvoid.net/326
